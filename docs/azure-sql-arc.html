<!DOCTYPE html>
<html>
<head>
<title>SQL Server on-premises configuration with Azure Arc</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<script>
	document.querySelectorAll('a').forEach(function(link) {
		link.setAttribute('target', '_blank');
	});
</script>
<!-- (styles and scripts unchanged) -->
<!-- ... -->
</head>
<body>
	<script>
		mermaid.initialize({
			startOnLoad: true,
			theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
					? 'dark'
					: 'default'
		});
	</script>
<h1 id="%F0%9F%93%98-configurazione-di-sql-server-on-premises-con-azure-arc">üìò SQL Server on-premises configuration with Azure Arc</h1>
<p>This guide describes the detailed procedure to connect a SQL Server instance running on Windows Server to <strong>Azure Arc</strong>, enabling management from the Azure Portal as a hybrid resource.</p>
<hr>
<h2 id="%E2%9C%85-requisiti">‚úÖ Requirements</h2>
<h3 id="%F0%9F%93%A1-requisiti-di-rete-uscita-dal-server-verso-internet">üì° Network requirements (outbound from server to internet)</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Destination</th>
<th>Port</th>
<th>Protocol</th>
</tr>
</thead>
<tbody>
<tr>
<td>DNS</td>
<td>*.azure.com, *.microsoft.com</td>
<td>53</td>
<td>UDP/TCP</td>
</tr>
<tr>
<td>HTTPS</td>
<td>*.azmk8s.io, *.azure-automation.net, *.blob.core.windows.net, *.azureedge.net, *.monitor.azure.com, *.login.microsoftonline.com</td>
<td>443</td>
<td>TCP</td>
</tr>
</tbody>
</table>
<blockquote>
<p>If there is a corporate proxy, you must configure it in Windows (<code>netsh winhttp set proxy</code>) or use it in <code>az</code> commands.</p>
</blockquote>
<hr>
<h3 id="%F0%9F%92%BB-requisiti-sul-server-windows">üíª Requirements on the Windows server</h3>
<ul>
<li>Windows Server 2016 or later</li>
<li>SQL Server 2012 or later</li>
<li>Local administrator account</li>
<li>Internet access</li>
<li>PowerShell 5.1+</li>
<li><code>sysadmin</code> permissions on the SQL Server instance</li>
<li>Azure CLI installed</li>
<li>Azure Connected Machine Agent installable</li>
</ul>
<hr>
<h3 id="%E2%98%81%EF%B8%8F-requisiti-su-azure">‚òÅÔ∏è Requirements on Azure</h3>
<ul>
<li>Active Azure subscription</li>
<li>Permissions to register Azure Arc resources</li>
<li>Resource group</li>
<li>Region supported by Azure Arc (e.g. <code>westeurope</code>)</li>
</ul>
<hr>
<h2 id="%E2%9A%99%EF%B8%8F-procedura-dettagliata">‚öôÔ∏è Step-by-step procedure</h2>
<hr>
<h3 id="%F0%9F%A5%87-1-installare-azure-cli">ü•á 1. Install Azure CLI</h3>
<p>Open PowerShell <strong>as administrator</strong> and run:</p>
<pre class="hljs"><code><div><span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> https://aka.ms/installazurecliwindows <span class="hljs-literal">-OutFile</span> .\AzureCLI.msi
<span class="hljs-built_in">Start-Process</span> msiexec.exe <span class="hljs-literal">-Wait</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-string">'/I AzureCLI.msi /quiet'</span>
</div></code></pre>
<p>Verify the installation:</p>
<pre class="hljs"><code><div>az version
</div></code></pre>
<hr>
<h3 id="%F0%9F%A5%88-2-autenticarsi-su-azure">ü•à 2. Authenticate to Azure</h3>
<pre class="hljs"><code><div>az login
</div></code></pre>
<p>If you have multiple subscriptions:</p>
<pre class="hljs"><code><div>az account set -<span class="hljs-literal">-subscription</span> <span class="hljs-string">"YOUR_SUBSCRIPTION_NAME"</span>
</div></code></pre>
<hr>
<h3 id="%F0%9F%A5%89-3-installare-azure-connected-machine-agent">ü•â 3. Install Azure Connected Machine Agent</h3>
<pre class="hljs"><code><div><span class="hljs-variable">$agentUrl</span> = <span class="hljs-string">"https://aka.ms/AzureConnectedMachineAgent"</span>
<span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$agentUrl</span> <span class="hljs-literal">-OutFile</span> <span class="hljs-string">".\AzureConnectedMachineAgent.msi"</span>
<span class="hljs-built_in">Start-Process</span> msiexec.exe <span class="hljs-literal">-Wait</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-string">"/i AzureConnectedMachineAgent.msi /quiet"</span>
</div></code></pre>
<hr>
<h3 id="%F0%9F%8F%85-4-connettere-il-server-a-azure-arc">üèÖ 4. Connect the server to Azure Arc</h3>
<pre class="hljs"><code><div>az connectedmachine connect `
	-<span class="hljs-literal">-resource</span><span class="hljs-literal">-group</span> NAME<span class="hljs-literal">-RG</span> `
	-<span class="hljs-literal">-location</span> westeurope `
	-<span class="hljs-literal">-name</span> LOGICAL<span class="hljs-literal">-SERVER</span><span class="hljs-literal">-NAME</span> `
	-<span class="hljs-literal">-tags</span> <span class="hljs-string">"env=onprem"</span> <span class="hljs-string">"managedBy=arc"</span>
</div></code></pre>
<hr>
<h3 id="%F0%9F%A7%A9-5-aggiungere-lestensione-sql-server">üß© 5. Add the SQL Server extension</h3>
<pre class="hljs"><code><div>az connectedmachine extension create `
	-<span class="hljs-literal">-machine</span><span class="hljs-literal">-name</span> LOGICAL<span class="hljs-literal">-SERVER</span><span class="hljs-literal">-NAME</span> `
	-<span class="hljs-literal">-name</span> Microsoft.AzureData.SqlServer `
	-<span class="hljs-literal">-resource</span><span class="hljs-literal">-group</span> NAME<span class="hljs-literal">-RG</span> `
	-<span class="hljs-literal">-location</span> westeurope `
	-<span class="hljs-literal">-publisher</span> Microsoft.AzureData `
	-<span class="hljs-literal">-type</span> SqlServer `
	-<span class="hljs-literal">-type</span><span class="hljs-literal">-handler</span><span class="hljs-literal">-version</span> <span class="hljs-number">1.0</span> `
	-<span class="hljs-literal">-settings</span> <span class="hljs-string">'{}'</span>
</div></code></pre>
<hr>
<h3 id="%F0%9F%A7%AA-6-registrare-sql-server-su-azure-arc">üß™ 6. Register SQL Server on Azure Arc</h3>
<p>Download the official script:</p>
<pre class="hljs"><code><div><span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> https://aka.ms/arc<span class="hljs-literal">-sql</span>/onboarding<span class="hljs-literal">-script</span> <span class="hljs-literal">-OutFile</span> .\EnableSQLArc.ps1
</div></code></pre>
<p>Run the script:</p>
<pre class="hljs"><code><div>.\EnableSQLArc.ps1 `
	<span class="hljs-literal">-azureResourceGroup</span> <span class="hljs-string">"NAME-RG"</span> `
	<span class="hljs-literal">-azureRegion</span> <span class="hljs-string">"westeurope"</span> `
	<span class="hljs-literal">-sqlInstanceName</span> <span class="hljs-string">"SQL-INSTANCE-NAME"</span> `
	<span class="hljs-literal">-useWindowsAuthentication</span>
</div></code></pre>
<blockquote>
<p>For named instances or custom ports:
Add <code>-sqlInstance &quot;NAME\INSTANCE&quot;</code> and <code>-sqlInstancePort 1433</code></p>
</blockquote>
<hr>
<h2 id="%E2%9C%85-verifica-su-azure">‚úÖ Check on Azure</h2>
<ol>
<li>Go to <strong>Azure Portal</strong></li>
<li>Navigate to <strong>Azure Arc &gt; Servers</strong></li>
<li>Check that the server is registered</li>
<li>Check that in <strong>SQL Server ‚Äì Azure Arc</strong> the SQL instance, version, configuration, and status are visible</li>
</ol>
<hr>
<h2 id="%F0%9F%8E%81-extra-opzionali">üéÅ Extra (optional)</h2>
<h3 id="%F0%9F%94%90-azure-key-vault-integration">üîê Azure Key Vault Integration</h3>
<p>To store and use secrets (e.g. connection strings).</p>
<h3 id="%F0%9F%93%8A-azure-monitor-e-defender-for-sql">üìä Azure Monitor and Defender for SQL</h3>
<p>To enable centralized monitoring, security, and auditing via Azure.</p>
<hr>
<h2 id="%F0%9F%93%8C-note-finali">üìå Final notes</h2>
<ul>
<li>Registration via Azure Arc <strong>does not move</strong> the database to the cloud</li>
<li>You can benefit from <strong>Azure Hybrid Benefit</strong></li>
<li>You can apply <strong>policy, compliance, and automation</strong> to on-premises SQL as you do for cloud SQL</li>
</ul>
<hr>

</body>
</html>
